(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7944],{42463:(e,t,o)=>{"use strict";o.d(t,{A:()=>i});var n=o(12115);let i=function(e){(0,n.useEffect)(e,[])}},44737:(e,t,o)=>{"use strict";o.d(t,{N:()=>s});var n=o(12115),i=o(99602),r=o(15896),l=o(75441),c=o(95155);function s(e){let t=e+"CollectionProvider",[o,s]=(0,i.A)(t),[a,u]=o(t,{collectionRef:{current:null},itemMap:new Map}),d=e=>{let{scope:t,children:o}=e,i=n.useRef(null),r=n.useRef(new Map).current;return(0,c.jsx)(a,{scope:t,itemMap:r,collectionRef:i,children:o})};d.displayName=t;let f=e+"CollectionSlot",m=(0,l.TL)(f),g=n.forwardRef((e,t)=>{let{scope:o,children:n}=e,i=u(f,o),l=(0,r.s)(t,i.collectionRef);return(0,c.jsx)(m,{ref:l,children:n})});g.displayName=f;let h=e+"CollectionItemSlot",w="data-radix-collection-item",p=(0,l.TL)(h),S=n.forwardRef((e,t)=>{let{scope:o,children:i,...l}=e,s=n.useRef(null),a=(0,r.s)(t,s),d=u(h,o);return n.useEffect(()=>(d.itemMap.set(s,{ref:s,...l}),()=>void d.itemMap.delete(s))),(0,c.jsx)(p,{...{[w]:""},ref:a,children:i})});return S.displayName=h,[{Provider:d,Slot:g,ItemSlot:S},function(t){let o=u(e+"CollectionConsumer",t);return n.useCallback(()=>{let e=o.collectionRef.current;if(!e)return[];let t=Array.from(e.querySelectorAll("[".concat(w,"]")));return Array.from(o.itemMap.values()).sort((e,o)=>t.indexOf(e.ref.current)-t.indexOf(o.ref.current))},[o.collectionRef,o.itemMap])},s]}},62322:(e,t,o)=>{"use strict";o.d(t,{Wn:()=>d,vz:()=>a});var n=o(19749),i=o(7675),r=o(74889),l=o(37817),c=o(6066),s=o(69554);function a(){let e,t,o,a,d,f=(0,n.c)(8),m=(0,c.useRouter)(),g=(0,l.LX)(),h=u;return f[0]===Symbol.for("react.memo_cache_sentinel")?(e=[r.S.AUTH.Login.key],t=e=>{h("Login attempt with token",(null==e?void 0:e.token)?"Token provided":"No token")},f[0]=e,f[1]=t):(e=f[0],t=f[1]),f[2]!==m||f[3]!==g?(o=async e=>{if(h("Login response",e),e&&"object"==typeof e&&"success"===e.status)s.oR.success("Successfully logged in"),h("Setting server status and redirecting"),g(e),setTimeout(()=>{m.push("/")},1e3);else{let t=e&&"object"==typeof e&&"message"in e?String(e.message):"Unknown error";h("Login failed",t),s.oR.error("Failed to login: ".concat(t))}},f[2]=m,f[3]=g,f[4]=o):o=f[4],f[5]===Symbol.for("react.memo_cache_sentinel")?(a=e=>{let t=e&&"object"==typeof e&&"message"in e?String(e.message):"Unknown error";h("Login error",t),s.oR.error("Failed to login: ".concat(t))},f[5]=a):a=f[5],f[6]!==o?(d={endpoint:r.S.AUTH.Login.endpoint,method:r.S.AUTH.Login.methods[0],mutationKey:e,onMutate:t,onSuccess:o,onError:a},f[6]=o,f[7]=d):d=f[7],(0,i.qk)(d)}function u(e,t){console.log("[Login Hook Debug] ".concat(e),t||"")}function d(){return(0,c.useRouter)(),(0,i.qk)({endpoint:r.S.AUTH.Logout.endpoint,method:r.S.AUTH.Logout.methods[0],mutationKey:[r.S.AUTH.Logout.key],onSuccess:async()=>{s.oR.success("Successfully logged out"),document.cookie="Seanime-Anilist-Session=; Max-Age=0; path=/; domain="+window.location.hostname,localStorage.removeItem("anilist_token"),setTimeout(()=>{window.location.href="/auth"},500)},onError:()=>{s.oR.error("Failed to log out")}})}},89248:(e,t,o)=>{Promise.resolve().then(o.bind(o,91779))},91779:(e,t,o)=>{"use strict";o.r(t),o.d(t,{default:()=>k,dynamic:()=>S});var n=o(95155),i=o(19749),r=o(62322),l=o(73826),c=o(2091),s=o(29724),a=o(6066),u=o(12115),d=o(38310);function f(e){let t,o,f,S=(0,i.c)(9);(0,a.useRouter)();let k=(0,s.md)(l.ST),{mutate:y}=(0,r.vz)(),v=u.useRef(!1),[x,A]=u.useState(null),[L,R]=u.useState(!1),_=p;return S[0]!==y||S[1]!==k?(t=()=>{if(k||_("Websocket not connected, but proceeding anyway"),_("Processing login, URL hash:",window.location.hash),function(e){let t="; ".concat(document.cookie).split("; ".concat(e,"="));if(2===t.length){var o;return(null==(o=t.pop())?void 0:o.split(";").shift())||""}return""}("Seanime-Anilist-Session")){_("Session cookie already exists, redirecting to home"),setTimeout(w,500);return}let e="";if(window.location.hash&&window.location.hash.includes("access_token")&&_("Token extracted from URL:",(e=window.location.hash.replace("#access_token=","").replace(/&.*/,""))?"Found token":"No token found"),!e){let t=localStorage.getItem("anilist_token");t&&(e=t,_("Using token from localStorage"))}if(e&&!v.current){_("Attempting login with token"),A(null),v.current=!0,localStorage.setItem("anilist_token",e),window.history&&window.history.replaceState&&window.history.replaceState({},document.title,window.location.pathname);let t="mirror"===d.env.NEXT_PUBLIC_PLATFORM;_("Mirror mode:",t?"true":"false"),t?(_("Using API login in mirror mode"),y({token:e},{onSuccess:()=>{_("Login API call successful"),setTimeout(h,1e3)},onError:e=>{_("Login API call failed",e),A("Failed to log in with AniList token. Please try again."),R(!1)}})):(_("Using direct cookie in standard mode"),document.cookie="Seanime-Anilist-Session=".concat(e,"; path=/; max-age=31536000"),setTimeout(g,1e3))}else e||v.current||(_("No token found"),A("Invalid or missing AniList token. Please try logging in again."))},S[0]=y,S[1]=k,S[2]=t):t=S[2],S[3]!==L||S[4]!==k?(o=[k,L],S[3]=L,S[4]=k,S[5]=o):o=S[5],u.useEffect(t,o),S[6]!==x||S[7]!==k?(f=(0,n.jsx)("div",{children:(0,n.jsx)(c.p8,{className:"fixed w-full h-full z-[80]",children:x?(0,n.jsxs)("div",{className:"flex flex-col items-center justify-center min-h-[40vh] space-y-4",children:[(0,n.jsx)("h3",{className:"text-xl font-semibold text-red-500",children:x}),(0,n.jsx)("button",{className:"px-4 py-2 rounded bg-indigo-600 text-white hover:bg-indigo-700",onClick:()=>{R(m),A(null),window.location.href="/auth"},children:"Retry Login"})]}):(0,n.jsx)("h3",{className:"mt-2",children:k?"Authenticating...":"Connecting..."})})}),S[6]=x,S[7]=k,S[8]=f):f=S[8],f}function m(e){return!e}function g(){window.location.href="/"}function h(){window.location.href="/"}function w(){window.location.href="/"}function p(e,t){console.log("[Auth Debug] ".concat(e),t||"")}let S="force-static";function k(){let e,t=(0,i.c)(1);return t[0]===Symbol.for("react.memo_cache_sentinel")?(e=(0,n.jsx)(f,{}),t[0]=e):e=t[0],e}},93052:(e,t,o)=>{"use strict";o.d(t,{jH:()=>r});var n=o(12115);o(95155);var i=n.createContext(void 0);function r(e){let t=n.useContext(i);return e||t||"ltr"}}},e=>{var t=t=>e(e.s=t);e.O(0,[3873,3380,844,2150,585,7825,2592,4791,3351,7401,8211,7654,4809,8154,9582,6094,6069,8441,6891,7358],()=>t(89248)),_N_E=e.O()}]);