(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7944],{42463:(e,t,o)=>{"use strict";o.d(t,{A:()=>i});var n=o(12115);let i=function(e){(0,n.useEffect)(e,[])}},44737:(e,t,o)=>{"use strict";o.d(t,{N:()=>s});var n=o(12115),i=o(99602),r=o(15896),c=o(75441),l=o(95155);function s(e){let t=e+"CollectionProvider",[o,s]=(0,i.A)(t),[a,u]=o(t,{collectionRef:{current:null},itemMap:new Map}),d=e=>{let{scope:t,children:o}=e,i=n.useRef(null),r=n.useRef(new Map).current;return(0,l.jsx)(a,{scope:t,itemMap:r,collectionRef:i,children:o})};d.displayName=t;let f=e+"CollectionSlot",m=(0,c.TL)(f),g=n.forwardRef((e,t)=>{let{scope:o,children:n}=e,i=u(f,o),c=(0,r.s)(t,i.collectionRef);return(0,l.jsx)(m,{ref:c,children:n})});g.displayName=f;let h=e+"CollectionItemSlot",p="data-radix-collection-item",w=(0,c.TL)(h),S=n.forwardRef((e,t)=>{let{scope:o,children:i,...c}=e,s=n.useRef(null),a=(0,r.s)(t,s),d=u(h,o);return n.useEffect(()=>(d.itemMap.set(s,{ref:s,...c}),()=>void d.itemMap.delete(s))),(0,l.jsx)(w,{...{[p]:""},ref:a,children:i})});return S.displayName=h,[{Provider:d,Slot:g,ItemSlot:S},function(t){let o=u(e+"CollectionConsumer",t);return n.useCallback(()=>{let e=o.collectionRef.current;if(!e)return[];let t=Array.from(e.querySelectorAll("[".concat(p,"]")));return Array.from(o.itemMap.values()).sort((e,o)=>t.indexOf(e.ref.current)-t.indexOf(o.ref.current))},[o.collectionRef,o.itemMap])},s]}},62322:(e,t,o)=>{"use strict";o.d(t,{Wn:()=>d,vz:()=>a});var n=o(19749),i=o(7675),r=o(74889),c=o(37817),l=o(6066),s=o(69554);function a(){let e,t,o,a,d,f=(0,n.c)(8),m=(0,l.useRouter)(),g=(0,c.LX)(),h=u;return f[0]===Symbol.for("react.memo_cache_sentinel")?(e=[r.S.AUTH.Login.key],t=e=>{h("Login attempt with token",(null==e?void 0:e.token)?"Token provided":"No token")},f[0]=e,f[1]=t):(e=f[0],t=f[1]),f[2]!==m||f[3]!==g?(o=async e=>{if(h("Login response",e),e&&"object"==typeof e&&"success"===e.status)s.oR.success("Successfully logged in"),h("Setting server status and redirecting"),g(e),setTimeout(()=>{m.push("/")},1e3);else{let t=e&&"object"==typeof e&&"message"in e?String(e.message):"Unknown error";h("Login failed",t),s.oR.error("Failed to login: ".concat(t))}},f[2]=m,f[3]=g,f[4]=o):o=f[4],f[5]===Symbol.for("react.memo_cache_sentinel")?(a=e=>{let t=e&&"object"==typeof e&&"message"in e?String(e.message):"Unknown error";h("Login error",t),s.oR.error("Failed to login: ".concat(t))},f[5]=a):a=f[5],f[6]!==o?(d={endpoint:r.S.AUTH.Login.endpoint,method:r.S.AUTH.Login.methods[0],mutationKey:e,onMutate:t,onSuccess:o,onError:a},f[6]=o,f[7]=d):d=f[7],(0,i.qk)(d)}function u(e,t){console.log("[Login Hook Debug] ".concat(e),t||"")}function d(){return(0,l.useRouter)(),(0,i.qk)({endpoint:r.S.AUTH.Logout.endpoint,method:r.S.AUTH.Logout.methods[0],mutationKey:[r.S.AUTH.Logout.key],onSuccess:async()=>{s.oR.success("Successfully logged out"),document.cookie="Seanime-Anilist-Session=; Max-Age=0; path=/; domain="+window.location.hostname,localStorage.removeItem("anilist_token"),setTimeout(()=>{window.location.href="/auth"},500)},onError:()=>{s.oR.error("Failed to log out")}})}},89248:(e,t,o)=>{Promise.resolve().then(o.bind(o,91779))},91779:(e,t,o)=>{"use strict";o.r(t),o.d(t,{default:()=>w,dynamic:()=>p});var n=o(95155),i=o(19749),r=o(62322),c=o(73826),l=o(2091),s=o(29724),a=o(6066),u=o(12115);function d(e){let t,o,d,p=(0,i.c)(8);(0,a.useRouter)();let w=(0,s.md)(c.ST);(0,r.vz)();let S=u.useRef(!1),[k,y]=u.useState(null),[x,v]=u.useState(!1),R=h;return p[0]!==w?(t=()=>{if(w||R("Websocket not connected, but proceeding anyway"),R("Processing login, URL hash:",window.location.hash),function(e){let t="; ".concat(document.cookie).split("; ".concat(e,"="));if(2===t.length){var o;return(null==(o=t.pop())?void 0:o.split(";").shift())||""}return""}("Seanime-Anilist-Session")){R("Session cookie already exists, redirecting to home"),setTimeout(g,500);return}let e="";if(window.location.hash&&window.location.hash.includes("access_token")&&R("Token extracted from URL:",(e=window.location.hash.replace("#access_token=","").replace(/&.*/,""))?"Found token":"No token found"),!e){let t=localStorage.getItem("anilist_token");t&&(e=t,R("Using token from localStorage"))}e&&!S.current?(R("Attempting login with token"),y(null),localStorage.setItem("anilist_token",e),window.history&&window.history.replaceState&&window.history.replaceState({},document.title,window.location.pathname),document.cookie="Seanime-Anilist-Session=".concat(e,"; path=/; max-age=31536000"),R("Set session cookie directly, redirecting to home"),setTimeout(m,1e3),S.current=!0):e||S.current||(R("No token found"),y("Invalid or missing AniList token. Please try logging in again."))},p[0]=w,p[1]=t):t=p[1],p[2]!==x||p[3]!==w?(o=[w,x],p[2]=x,p[3]=w,p[4]=o):o=p[4],u.useEffect(t,o),p[5]!==k||p[6]!==w?(d=(0,n.jsx)("div",{children:(0,n.jsx)(l.p8,{className:"fixed w-full h-full z-[80]",children:k?(0,n.jsxs)("div",{className:"flex flex-col items-center justify-center min-h-[40vh] space-y-4",children:[(0,n.jsx)("h3",{className:"text-xl font-semibold text-red-500",children:k}),(0,n.jsx)("button",{className:"px-4 py-2 rounded bg-indigo-600 text-white hover:bg-indigo-700",onClick:()=>{v(f),y(null),window.location.href="/auth"},children:"Retry Login"})]}):(0,n.jsx)("h3",{className:"mt-2",children:w?"Authenticating...":"Connecting..."})})}),p[5]=k,p[6]=w,p[7]=d):d=p[7],d}function f(e){return!e}function m(){window.location.href="/"}function g(){window.location.href="/"}function h(e,t){console.log("[Auth Debug] ".concat(e),t||"")}let p="force-static";function w(){let e,t=(0,i.c)(1);return t[0]===Symbol.for("react.memo_cache_sentinel")?(e=(0,n.jsx)(d,{}),t[0]=e):e=t[0],e}},93052:(e,t,o)=>{"use strict";o.d(t,{jH:()=>r});var n=o(12115);o(95155);var i=n.createContext(void 0);function r(e){let t=n.useContext(i);return e||t||"ltr"}}},e=>{var t=t=>e(e.s=t);e.O(0,[3873,3380,844,2150,585,7825,2592,4791,3351,7401,8211,7654,4809,8154,9582,6094,6069,8441,6891,7358],()=>t(89248)),_N_E=e.O()}]);